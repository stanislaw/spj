# spj

Учебный парсер JSON на языке C, создаваемый на основе обсуждения, открытого на сайте [ХэшКод.Исследования](http://hashcode.ru/research/): [Простейший парсер JSON на C/Objective-C](http://hashcode.ru/research/291943/%D0%BF%D1%80%D0%BE%D1%81%D1%82%D0%B5%D0%B9%D1%88%D0%B8%D0%B9-%D0%BF%D0%B0%D1%80%D1%81%D0%B5%D1%80-json-%D0%BD%D0%B0-c-objective-c).  

## Установка

```bash
git clone git@github.com:stanislaw/spj.git
cd spj/
make # компиляция и запуск
```

## Первичные концепция, ТЗ и Черновик API в одном разделе

* Скорость разбора.
* Скорость доступа: функция доступа(чтения) элементов на любой глубине (в том числе по ключам(name) объектов Object).

* Результат парсинга - набор "read-only" структур для многократного поиска данных.

* Исходные данные копируются 

> Плюсом является то, что после окончания разбора память, занимаемую исходной json строкой можно освободить.

> Еще один плюс такого решения (это уже дальнейшее развитие), что в
некоторых случаях можно читать данные поблочно (из файла или сокета),
например используя технику, которую продемонстрировал @VladD.

> Не похоже, что в процессе разбора придется обращаться к ранее
прочитанным данным, более чем на одну позицию.

* О структурах Object и Array. Вы хотели бы сделать их обе на динамических массивах, или интересуетесь также программированием списков? В принципе, если структуры после парсинга не будут модифицироваться, то на массивах будет эффективней.

> На массивах.

* А поиск по имени последовательный (типичный размер не очень большой).

* Красивая задача - это чтобы можно было удобно работать с spj без привлечения Cocoa API.

* Есть альтернативный вариант концепции - или можно его сделать конфигурируемым - это __вообще не хранить/не создавать никакие структуры для хранения__, а прямо на лету передавать разобранный материал в функцию, заданную пользователем. В [SBJson](http://cocoadocs.org/docsets/SBJson/4.0.0/Classes/SBJson4Parser.html) и вообще в Objective-C этого можно добиться с помощью blocks, а в C, наверное, для этого можно использовать void * pointers to function.


## Примеры использования будущих API

* На примере TypicalJSON:

1. Разобрать исходную строку;
2. Получить данные root-Object по ключу "data";
3. Пройти по всем Object, представляющим пользователей.
4. Для каждого такого Object, пройти по всем парам {"имя":"соответствующее ему значение"}.
5. Записать эти значения в БД или соответствующие им по структуре
   объекты Objective-C.

> В реальной практике этот проход нужен для наполнения данными соответствующих записей объектов вроде User с соответствующими полями (id, email, name, ...) и, например, записью этих объектов в БД (В Objective-C эти объекты основаны на структурах struct).

## Примеры JSON для вдохновения

* [Typical JSON](https://github.com/stanislaw/spj/blob/master/TypicalJSON.md)
* `curl http://hashcode.ru/api/json/deleted_questions?startAt=1&amount=1`

